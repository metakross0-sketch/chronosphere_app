<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞–º–∏ –∏ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .city-item, .shop-item {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="max-w-6xl mx-auto p-6">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">üè™ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <p class="text-white opacity-90">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞–º–∏ –∏ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏</p>
        </header>
        
        <!-- –¢–∞–±—ã -->
        <div class="card">
            <div class="flex gap-2 border-b pb-0">
                <button class="tab-btn active" onclick="showTab('cities')">–ì–æ—Ä–æ–¥–∞</button>
                <button class="tab-btn" onclick="showTab('shops')">–ú–∞–≥–∞–∑–∏–Ω—ã</button>
                <button class="tab-btn" onclick="showTab('categories')">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                <button class="tab-btn" onclick="showTab('registrations')">
                    üîî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ <span id="regCount" class="ml-1"></span>
                </button>
            </div>
        </div>
        
        <!-- –ì–æ—Ä–æ–¥–∞ -->
        <div id="cities-tab" class="tab-content">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥</h2>
                <form id="cityForm" onsubmit="addCity(event)">
                    <div class="relative mb-3">
                        <input 
                            type="text" 
                            id="citySearch" 
                            placeholder="üîç –ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..." 
                            autocomplete="off"
                            oninput="filterCities()"
                            onfocus="showCityDropdown()"
                        >
                        <div id="cityDropdown" class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-60 overflow-y-auto shadow-lg">
                            <div class="p-2 text-sm text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤...</div>
                        </div>
                    </div>
                    <input type="hidden" id="cityName" required>
                    <input type="hidden" id="cityLat" required>
                    <input type="hidden" id="cityLon" required>
                    
                    <div id="selectedCityInfo" class="hidden mb-3 p-3 bg-blue-50 rounded-lg">
                        <div class="font-semibold text-blue-900" id="selectedCityName"></div>
                        <div class="text-sm text-blue-700" id="selectedCityCoords"></div>
                    </div>
                    
                    <input type="number" id="cityZoom" placeholder="–ú–∞—Å—à—Ç–∞–± –∫–∞—Ä—Ç—ã (–æ—Å—Ç–∞–≤—å—Ç–µ 12)" value="12">
                    <textarea id="cityDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
                    <button type="submit" class="btn btn-primary w-full">–î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥</button>
                </form>
            </div>
            
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">üìç –ú–æ–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞</h2>
                <div id="citiesList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <!-- –ú–∞–≥–∞–∑–∏–Ω—ã -->
        <div id="shops-tab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω</h2>
                <form id="shopForm" onsubmit="addShop(event)">
                    <select id="shopCity" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    </select>
                    <select id="shopCategory" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    </select>
                    <input type="text" id="shopName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞" required>
                    <input type="text" id="shopCustomId" placeholder="ID –º–∞–≥–∞–∑–∏–Ω–∞ (–∏–∑ –≥–ª–∞–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã)" required>
                    <input type="text" id="shopAddress" placeholder="–ê–¥—Ä–µ—Å" required>
                    <input type="number" step="0.0001" id="shopLat" placeholder="–®–∏—Ä–æ—Ç–∞" required>
                    <input type="number" step="0.0001" id="shopLon" placeholder="–î–æ–ª–≥–æ—Ç–∞" required>
                    <input type="tel" id="shopPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                    <textarea id="shopDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="3"></textarea>
                    <input type="text" id="shopHours" placeholder="–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: 9:00 - 21:00)">
                    <button type="submit" class="btn btn-primary w-full">–î–æ–±–∞–≤–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω</button>
                </form>
            </div>
            
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">üè¨ –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤</h2>
                <div id="shopsList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div id="categories-tab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                <form id="categoryForm" onsubmit="addCategory(event)">
                    <input type="text" id="categoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" required>
                    <input type="text" id="categoryIcon" placeholder="–ò–∫–æ–Ω–∫–∞ (emoji, –Ω–∞–ø—Ä–∏–º–µ—Ä: üëï)" required>
                    <input type="color" id="categoryColor" value="#3B82F6">
                    <button type="submit" class="btn btn-primary w-full">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                </form>
            </div>
            
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">üè∑Ô∏è –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h2>
                <div id="categoriesList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
        
        <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ -->
        <div id="registrations-tab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-2xl font-bold mb-4">üîî –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –º–∞–≥–∞–∑–∏–Ω–æ–≤</h2>
                <div class="flex gap-2 mb-4">
                    <button onclick="loadRegistrations('pending')" class="btn btn-primary">–û–∂–∏–¥–∞—é—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏</button>
                    <button onclick="loadRegistrations('approved')" class="btn bg-green-500 text-white">–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</button>
                    <button onclick="loadRegistrations('rejected')" class="btn bg-red-500 text-white">–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</button>
                </div>
                <div id="registrationsList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = 'https://chronosphere.pythonanywhere.com';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`${tab}-tab`).classList.remove('hidden');
            event.target.classList.add('active');
            
            if (tab === 'cities') loadCities();
            if (tab === 'shops') loadShops();
            if (tab === 'categories') loadCategories();
        }
        
        // ==================== –ì–û–†–û–î–ê ====================
        
        // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏ (—Ç–æ–ø-200 –ø–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—é)
        const RUSSIAN_CITIES = [
            "–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å", "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–°–∞–º–∞—Ä–∞", "–û–º—Å–∫", "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
            "–£—Ñ–∞", "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫", "–í–æ—Ä–æ–Ω–µ–∂", "–ü–µ—Ä–º—å", "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–°–∞—Ä–∞—Ç–æ–≤", "–¢—é–º–µ–Ω—å", "–¢–æ–ª—å—è—Ç—Ç–∏", "–ò–∂–µ–≤—Å–∫",
            "–ë–∞—Ä–Ω–∞—É–ª", "–£–ª—å—è–Ω–æ–≤—Å–∫", "–ò—Ä–∫—É—Ç—Å–∫", "–•–∞–±–∞—Ä–æ–≤—Å–∫", "–Ø—Ä–æ—Å–ª–∞–≤–ª—å", "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫", "–ú–∞—Ö–∞—á–∫–∞–ª–∞", "–¢–æ–º—Å–∫", "–û—Ä–µ–Ω–±—É—Ä–≥", "–ö–µ–º–µ—Ä–æ–≤–æ",
            "–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫", "–†—è–∑–∞–Ω—å", "–ù–∞–±–µ—Ä–µ–∂–Ω—ã–µ –ß–µ–ª–Ω—ã", "–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å", "–ü–µ–Ω–∑–∞", "–õ–∏–ø–µ—Ü–∫", "–ö–∏—Ä–æ–≤", "–ß–µ–±–æ–∫—Å–∞—Ä—ã", "–¢—É–ª–∞", "–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥",
            "–ö—É—Ä—Å–∫", "–£–ª–∞–Ω-–£–¥—ç", "–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å", "–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫", "–°–æ—á–∏", "–ë–µ–ª–≥–æ—Ä–æ–¥", "–ù–∏–∂–Ω–∏–π –¢–∞–≥–∏–ª", "–í–ª–∞–¥–∏–º–∏—Ä", "–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫", "–ö–∞–ª—É–≥–∞",
            "–°—É—Ä–≥—É—Ç", "–ß–∏—Ç–∞", "–ì—Ä–æ–∑–Ω—ã–π", "–°–º–æ–ª–µ–Ω—Å–∫", "–í–æ–ª–∂—Å–∫–∏–π", "–ß–µ—Ä–µ–ø–æ–≤–µ—Ü", "–í–ª–∞–¥–∏–∫–∞–≤–∫–∞–∑", "–ö—É—Ä–≥–∞–Ω", "–í–æ–ª–æ–≥–¥–∞", "–°–∞—Ä–∞–Ω—Å–∫",
            "–¢–∞–º–±–æ–≤", "–°—Ç–µ—Ä–ª–∏—Ç–∞–º–∞–∫", "–ü–µ—Ç—Ä–æ–∑–∞–≤–æ–¥—Å–∫", "–ö–æ—Å—Ç—Ä–æ–º–∞", "–ù–∏–∂–Ω–µ–≤–∞—Ä—Ç–æ–≤—Å–∫", "–ô–æ—à–∫–∞—Ä-–û–ª–∞", "–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫", "–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫-–Ω–∞-–ê–º—É—Ä–µ", "–¢–∞–≥–∞–Ω—Ä–æ–≥", "–°—ã–∫—Ç—ã–≤–∫–∞—Ä",
            "–ë—Ä–∞—Ç—Å–∫", "–ù–∞–ª—å—á–∏–∫", "–î–∑–µ—Ä–∂–∏–Ω—Å–∫", "–®–∞—Ö—Ç—ã", "–û—Ä–µ–ª", "–ê–Ω–≥–∞—Ä—Å–∫", "–ù–∏–∂–Ω–µ–∫–∞–º—Å–∫", "–ë–ª–∞–≥–æ–≤–µ—â–µ–Ω—Å–∫", "–í–µ–ª–∏–∫–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "–ü—Å–∫–æ–≤",
            "–≠–Ω–≥–µ–ª—å—Å", "–ë–∏–π—Å–∫", "–ü—Ä–æ–∫–æ–ø—å–µ–≤—Å–∫", "–†—ã–±–∏–Ω—Å–∫", "–ë–∞–ª–∞–∫–æ–≤–æ", "–ê—Ä–º–∞–≤–∏—Ä", "–°–µ–≤–µ—Ä–æ–¥–≤–∏–Ω—Å–∫", "–ö–æ—Ä–æ–ª–µ–≤", "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–ö–∞–º—á–∞—Ç—Å–∫–∏–π", "–ú—ã—Ç–∏—â–∏",
            "–õ—é–±–µ—Ä—Ü—ã", "–•–∏–º–∫–∏", "–ü–æ–¥–æ–ª—å—Å–∫", "–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫", "–û–¥–∏–Ω—Ü–æ–≤–æ", "–î–æ–º–æ–¥–µ–¥–æ–≤–æ", "–†–∞–º–µ–Ω—Å–∫–æ–µ", "–ñ—É–∫–æ–≤—Å–∫–∏–π", "–ü—É—à–∫–∏–Ω–æ", "–°–µ—Ä–ø—É—Ö–æ–≤",
            "–ö–æ–ª–æ–º–Ω–∞", "–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å", "–ë–∞–ª–∞—à–∏—Ö–∞", "–†–µ—É—Ç–æ–≤", "–û—Ä–µ—Ö–æ–≤–æ-–ó—É–µ–≤–æ", "–°–µ—Ä–≥–∏–µ–≤ –ü–æ—Å–∞–¥", "–©–µ–ª–∫–æ–≤–æ", "–ù–æ–≥–∏–Ω—Å–∫", "–ö–ª–∏–º–æ–≤—Å–∫", "–í–∏–¥–Ω–æ–µ",
            "–í–æ–ª–≥–æ–¥–æ–Ω—Å–∫", "–ö–∞–º–µ–Ω—Å–∫-–£—Ä–∞–ª—å—Å–∫–∏–π", "–ö–æ–ø–µ–π—Å–∫", "–ú–∏–∞—Å—Å", "–ó–ª–∞—Ç–æ—É—Å—Ç", "–û–∑–µ—Ä—Å–∫", "–°–Ω–µ–∂–∏–Ω—Å–∫", "–¢—Ä–æ–∏—Ü–∫", "–ü–µ—Ä–≤–æ—É—Ä–∞–ª—å—Å–∫", "–†–µ–≤–¥–∞",
            "–ù–æ–≤–æ—É—Ä–∞–ª—å—Å–∫", "–í–µ—Ä—Ö–Ω—è—è –ü—ã—à–º–∞", "–ê—Å–±–µ—Å—Ç", "–ö–∞–º–µ–Ω—Å–∫-–®–∞—Ö—Ç–∏–Ω—Å–∫–∏–π", "–ù–æ–≤–æ—á–µ—Ä–∫–∞—Å—Å–∫", "–ë–∞—Ç–∞–π—Å–∫", "–ê–∑–æ–≤", "–ù–æ–≤–æ—à–∞—Ö—Ç–∏–Ω—Å–∫", "–ï–π—Å–∫", "–ö—Ä—ã–º—Å–∫",
            "–¢–∏—Ö–æ—Ä–µ—Ü–∫", "–¢—É–∞–ø—Å–µ", "–ê–Ω–∞–ø–∞", "–ì–µ–ª–µ–Ω–¥–∂–∏–∫", "–ù–µ–≤–∏–Ω–Ω–æ–º—ã—Å—Å–∫", "–ü—è—Ç–∏–≥–æ—Ä—Å–∫", "–ö–∏—Å–ª–æ–≤–æ–¥—Å–∫", "–ï—Å—Å–µ–Ω—Ç—É–∫–∏", "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã", "–ë—É–¥–µ–Ω–Ω–æ–≤—Å–∫",
            "–ß–µ—Ä–∫–µ—Å—Å–∫", "–≠–ª–∏—Å—Ç–∞", "–ú–∞–π–∫–æ–ø", "–ê–±–∞–∫–∞–Ω", "–ö—ã–∑—ã–ª", "–ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫", "–ë–∏—Ä–æ–±–∏–¥–∂–∞–Ω", "–Ø–∫—É—Ç—Å–∫", "–ú–∞–≥–∞–¥–∞–Ω", "–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫",
            "–ê–Ω–∞–¥—ã—Ä—å", "–°–∞–ª–µ—Ö–∞—Ä–¥", "–ù–∞—Ä—å—è–Ω-–ú–∞—Ä", "–í–æ—Ä–∫—É—Ç–∞", "–£—Ö—Ç–∞", "–£—Å–∏–Ω—Å–∫", "–ò–Ω—Ç–∞", "–ü–µ—á–æ—Ä–∞", "–°–æ—Å–Ω–æ–≥–æ—Ä—Å–∫", "–°–µ–≤–µ—Ä—Å–∫",
            "–ó–µ–ª–µ–Ω–æ–≥–æ—Ä—Å–∫", "–ñ–µ–ª–µ–∑–Ω–æ–≥–æ—Ä—Å–∫", "–ê—á–∏–Ω—Å–∫", "–ú–∏–Ω—É—Å–∏–Ω—Å–∫", "–ù–æ—Ä–∏–ª—å—Å–∫", "–ö–∞–Ω—Å–∫", "–£—Å–æ–ª—å–µ-–°–∏–±–∏—Ä—Å–∫–æ–µ", "–ê–Ω–≥–∞—Ä—Å–∫", "–ß–µ—Ä–µ–º—Ö–æ–≤–æ", "–¢—É–ª—É–Ω",
            "–ë–æ–¥–∞–π–±–æ", "–£—Å—Ç—å-–ò–ª–∏–º—Å–∫", "–£—Å—Ç—å-–ö—É—Ç", "–ê–ª–¥–∞–Ω", "–ú–∏—Ä–Ω—ã–π", "–ù–µ—Ä—é–Ω–≥—Ä–∏", "–¢—ã–Ω–¥–∞", "–°–≤–æ–±–æ–¥–Ω—ã–π", "–ó–µ—è", "–ë–µ–ª–æ–≥–æ—Ä—Å–∫",
            "–†–∞–π—á–∏—Ö–∏–Ω—Å–∫", "–ó–∞–≤–∏—Ç–∏–Ω—Å–∫", "–ê—Ä—Å–µ–Ω—å–µ–≤", "–ê—Ä—Ç–µ–º", "–î–∞–ª—å–Ω–µ–≥–æ—Ä—Å–∫", "–ù–∞—Ö–æ–¥–∫–∞", "–ü–∞—Ä—Ç–∏–∑–∞–Ω—Å–∫", "–°–ø–∞—Å—Å–∫-–î–∞–ª—å–Ω–∏–π", "–£—Å—Å—É—Ä–∏–π—Å–∫", "–§–æ–∫–∏–Ω–æ"
        ].sort();
        
        let allCitiesCache = [];
        
        function showCityDropdown() {
            const dropdown = document.getElementById('cityDropdown');
            dropdown.classList.remove('hidden');
            if (allCitiesCache.length === 0) {
                loadAllCities();
            }
        }
        
        function loadAllCities() {
            const dropdown = document.getElementById('cityDropdown');
            allCitiesCache = RUSSIAN_CITIES;
            renderCityDropdown(allCitiesCache);
        }
        
        function filterCities() {
            const search = document.getElementById('citySearch').value.toLowerCase();
            const filtered = RUSSIAN_CITIES.filter(city => 
                city.toLowerCase().includes(search)
            );
            renderCityDropdown(filtered);
        }
        
        function renderCityDropdown(cities) {
            const dropdown = document.getElementById('cityDropdown');
            
            if (cities.length === 0) {
                dropdown.innerHTML = '<div class="p-3 text-gray-500">–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
                return;
            }
            
            dropdown.innerHTML = cities.map(city => `
                <div class="p-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors" 
                     onclick="selectCity('${city}')">
                    <span class="font-medium">${city}</span>
                </div>
            `).join('');
        }
        
        async function selectCity(cityName) {
            document.getElementById('citySearch').value = cityName;
            document.getElementById('cityDropdown').classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const info = document.getElementById('selectedCityInfo');
            const nameEl = document.getElementById('selectedCityName');
            const coordsEl = document.getElementById('selectedCityCoords');
            
            nameEl.textContent = cityName;
            coordsEl.textContent = '‚è≥ –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã...';
            info.classList.remove('hidden');
            
            try {
                const response = await fetch(`${API_BASE}/api/geocode?city=${encodeURIComponent(cityName)}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('cityName').value = cityName;
                    document.getElementById('cityLat').value = data.latitude.toFixed(4);
                    document.getElementById('cityLon').value = data.longitude.toFixed(4);
                    coordsEl.textContent = `üìç ${data.latitude.toFixed(4)}, ${data.longitude.toFixed(4)}`;
                } else {
                    coordsEl.textContent = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã';
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ—Ä–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π.');
                }
            } catch (error) {
                coordsEl.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç';
                console.error(error);
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('cityDropdown');
            const search = document.getElementById('citySearch');
            if (dropdown && search && !dropdown.contains(e.target) && e.target !== search) {
                dropdown.classList.add('hidden');
            }
        });
        
        async function addCity(e) {
            e.preventDefault();
            
            const cityName = document.getElementById('cityName').value;
            const latitude = parseFloat(document.getElementById('cityLat').value);
            const longitude = parseFloat(document.getElementById('cityLon').value);
            const cityZoom = parseInt(document.getElementById('cityZoom').value);
            const cityDesc = document.getElementById('cityDesc').value;
            
            if (!cityName || !latitude || !longitude) {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞');
                return;
            }
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '–î–æ–±–∞–≤–ª—è–µ–º...';
            submitBtn.disabled = true;
            
            try {
                const cityData = {
                    name: cityName,
                    latitude: latitude,
                    longitude: longitude,
                    zoom_level: cityZoom,
                    description: cityDesc
                };
                
                const response = await fetch(`${API_BASE}/api/admin/cities`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cityData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`‚úÖ –ì–æ—Ä–æ–¥ "${cityName}" –¥–æ–±–∞–≤–ª–µ–Ω!`);
                    document.getElementById('cityForm').reset();
                    document.getElementById('cityZoom').value = 12;
                    document.getElementById('selectedCityInfo').classList.add('hidden');
                    document.getElementById('citySearch').value = '';
                    loadCities();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞: ' + error.message);
                console.error(error);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }
        
        async function loadCities() {
            try {
                const response = await fetch(`${API_BASE}/api/cities`);
                const data = await response.json();
                
                if (data.success) {
                    displayCities(data.cities);
                    updateCitySelects(data.cities);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ—Ä–æ–¥–æ–≤:', error);
            }
        }
        
        function displayCities(cities) {
            const list = document.getElementById('citiesList');
            list.innerHTML = '';
            
            if (cities.length === 0) {
                list.innerHTML = '<p class="text-gray-500">–ù–µ—Ç –≥–æ—Ä–æ–¥–æ–≤</p>';
                return;
            }
            
            cities.forEach(city => {
                const item = document.createElement('div');
                item.className = 'city-item';
                item.innerHTML = `
                    <div>
                        <h3 class="font-bold text-lg">üìç ${city.name}</h3>
                        <p class="text-sm text-gray-600">${city.description || ''}</p>
                        <p class="text-xs text-gray-500">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${city.latitude}, ${city.longitude}</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-danger text-sm" onclick="deleteCity(${city.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        function updateCitySelects(cities) {
            const select = document.getElementById('shopCity');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>';
            cities.forEach(city => {
                select.innerHTML += `<option value="${city.id}">${city.name}</option>`;
            });
        }
        
        async function deleteCity(cityId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≥–æ—Ä–æ–¥? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/cities/${cityId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('–ì–æ—Ä–æ–¥ —É–¥–∞–ª–µ–Ω');
                    loadCities();
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }
        
        // ==================== –ú–ê–ì–ê–ó–ò–ù–´ ====================
        
        async function addShop(e) {
            e.preventDefault();
            
            const shopData = {
                city_id: parseInt(document.getElementById('shopCity').value),
                category_id: parseInt(document.getElementById('shopCategory').value),
                name: document.getElementById('shopName').value,
                custom_id: document.getElementById('shopCustomId').value,
                address: document.getElementById('shopAddress').value,
                latitude: parseFloat(document.getElementById('shopLat').value),
                longitude: parseFloat(document.getElementById('shopLon').value),
                phone: document.getElementById('shopPhone').value,
                description: document.getElementById('shopDesc').value,
                working_hours: document.getElementById('shopHours').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/shops`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(shopData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('–ú–∞–≥–∞–∑–∏–Ω —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    document.getElementById('shopForm').reset();
                    loadShops();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞');
                console.error(error);
            }
        }
        
        async function loadShops() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/shops`);
                const data = await response.json();
                
                if (data.success) {
                    displayShops(data.shops);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤:', error);
            }
        }
        
        function displayShops(shops) {
            const list = document.getElementById('shopsList');
            list.innerHTML = '';
            
            if (shops.length === 0) {
                list.innerHTML = '<p class="text-gray-500">–ù–µ—Ç –º–∞–≥–∞–∑–∏–Ω–æ–≤</p>';
                return;
            }
            
            shops.forEach(shop => {
                const item = document.createElement('div');
                item.className = 'shop-item';
                item.innerHTML = `
                    <div>
                        <h3 class="font-bold text-lg">üè¨ ${shop.name}</h3>
                        <p class="text-sm text-gray-600">${shop.address}</p>
                        <p class="text-xs text-gray-500">–ì–æ—Ä–æ–¥: ${shop.city_name} | ${shop.category_name}</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn btn-danger text-sm" onclick="deleteShop(${shop.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        async function deleteShop(shopId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/shops/${shopId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('–ú–∞–≥–∞–∑–∏–Ω —É–¥–∞–ª–µ–Ω');
                    loadShops();
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }
        
        // ==================== –ö–ê–¢–ï–ì–û–†–ò–ò ====================
        
        async function addCategory(e) {
            e.preventDefault();
            
            const categoryData = {
                name: document.getElementById('categoryName').value,
                icon: document.getElementById('categoryIcon').value,
                color: document.getElementById('categoryColor').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/categories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(categoryData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                    document.getElementById('categoryForm').reset();
                    loadCategories();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
            }
        }
        
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/categories`);
                const data = await response.json();
                
                if (data.success) {
                    displayCategories(data.categories);
                    updateCategorySelect(data.categories);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
            }
        }
        
        function displayCategories(categories) {
            const list = document.getElementById('categoriesList');
            list.innerHTML = '';
            
            if (categories.length === 0) {
                list.innerHTML = '<p class="text-gray-500">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>';
                return;
            }
            
            categories.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'city-item';
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div style="background: ${cat.color}20; padding: 8px; border-radius: 8px; font-size: 24px;">
                            ${cat.icon}
                        </div>
                        <h3 class="font-bold">${cat.name}</h3>
                    </div>
                    <button class="btn btn-danger text-sm" onclick="deleteCategory(${cat.id})">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                list.appendChild(item);
            });
        }
        
        function updateCategorySelect(categories) {
            const select = document.getElementById('shopCategory');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
            categories.forEach(cat => {
                select.innerHTML += `<option value="${cat.id}">${cat.icon} ${cat.name}</option>`;
            });
        }
        
        async function deleteCategory(catId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/categories/${catId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞');
                    loadCategories();
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }
        
        // ==================== –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ====================
        
        async function loadRegistrations(status = 'pending') {
            try {
                const response = await fetch(`${API_BASE}/api/admin/registrations?status=${status}`);
                const data = await response.json();
                
                const list = document.getElementById('registrationsList');
                
                if (data.registrations.length === 0) {
                    list.innerHTML = '<p class="text-gray-500">–ù–µ—Ç –∑–∞—è–≤–æ–∫</p>';
                    return;
                }
                
                list.innerHTML = data.registrations.map(reg => `
                    <div class="border rounded-lg p-4 mb-3 ${status === 'pending' ? 'border-yellow-400 bg-yellow-50' : status === 'approved' ? 'border-green-400 bg-green-50' : 'border-red-400 bg-red-50'}">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h3 class="font-bold text-lg mb-2">üè™ ${reg.name}</h3>
                                <p class="text-sm"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${reg.category}</p>
                                <p class="text-sm"><strong>–ì–æ—Ä–æ–¥:</strong> ${reg.city}</p>
                                <p class="text-sm"><strong>–ê–¥—Ä–µ—Å:</strong> ${reg.address}</p>
                                <p class="text-sm"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${reg.phone}</p>
                                ${reg.telegram ? `<p class="text-sm"><strong>Telegram:</strong> ${reg.telegram}</p>` : ''}
                                ${reg.email ? `<p class="text-sm"><strong>Email:</strong> ${reg.email}</p>` : ''}
                            </div>
                            <div>
                                <p class="text-sm mb-2"><strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${reg.latitude}, ${reg.longitude}</p>
                                ${reg.description ? `<p class="text-sm mb-2"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${reg.description}</p>` : ''}
                                <a href="${reg.sheet_url}" target="_blank" class="text-blue-600 text-sm underline">
                                    üìã –û—Ç–∫—Ä—ã—Ç—å Google —Ç–∞–±–ª–∏—Ü—É
                                </a>
                                <p class="text-xs text-gray-500 mt-2">ID —Ç–∞–±–ª–∏—Ü—ã: ${reg.spreadsheet_id}</p>
                                <p class="text-xs text-gray-500">–î–∞—Ç–∞: ${new Date(reg.created_at).toLocaleString()}</p>
                            </div>
                        </div>
                        ${status === 'pending' ? `
                            <div class="flex gap-2 mt-4">
                                <button onclick="approveRegistration(${reg.id})" class="btn btn-success flex-1">
                                    ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
                                </button>
                                <button onclick="rejectRegistration(${reg.id})" class="btn btn-danger flex-1">
                                    ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ
                if (status === 'pending') {
                    document.getElementById('regCount').textContent = data.registrations.length > 0 ? `(${data.registrations.length})` : '';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π:', error);
                document.getElementById('registrationsList').innerHTML = '<p class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
            }
        }
        
        async function approveRegistration(regId) {
            if (!confirm('–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É –∏ —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/registrations/${regId}/approve`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    alert(`‚úÖ –ú–∞–≥–∞–∑–∏–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! ID: ${data.shop_id}`);
                    loadRegistrations('pending');
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏');
            }
        }
        
        async function rejectRegistration(regId) {
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/registrations/${regId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason })
                });
                const data = await response.json();
                
                if (data.success) {
                    alert('‚ùå –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
                    loadRegistrations('pending');
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadCities();
            loadCategories();
            loadRegistrations('pending'); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            feather.replace();
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            setInterval(() => {
                loadRegistrations('pending');
            }, 60000); // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        });
    </script>
</body>
</html>
